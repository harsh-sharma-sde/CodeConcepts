---
title: React Hydration Issues
description: Understand what hydration issues are in React, why they occur, and strategies to fix them
order: 29
---

To an SDE 2, **Hydration** is the "Handshake" between the static HTML generated by the server and the JavaScript-driven interactivity required by the client. 

A **Hydration Mismatch** occurs when the DOM tree generated by the server does not exactly match the initial Virtual DOM tree generated by React on the client.

---

### 1. The Under-the-Hood Mechanic
When React boots up in the browser after an SSR request, it doesn't call `render()`. It calls `hydrate()`.
1. **Reconciliation:** React walks the existing DOM nodes in the browser.
2. **Comparison:** It generates a Virtual DOM tree from your components and compares it against the existing DOM.
3. **Attaching Listeners:** If they match, React simply attaches event listeners (like `onClick`) to the existing nodes. This is extremely fast.
4. **Bailout:** If they **don't match**, React throws a warning (or error in React 18+), discards the server-rendered HTML, and performs a full client-side render of that subtree to ensure the UI is correct.

---

### 2. Root Cause 1: Non-Deterministic Data
**The SDE 2 View:** If your component relies on data that changes every time it’s called (like a timestamp or a random ID), the server will generate one value, but the client (executing milliseconds later) will generate another.

```javascript
// ❌ Problem: Mismatch
function Header() {
  return <div>Current Time: {new Date().toLocaleTimeString()}</div>;
}
```
*   **Server Result:** `<div>Current Time: 12:00:00 PM</div>`
*   **Client Result:** `<div>Current Time: 12:00:01 PM</div>` (Hydration fails!)

---

### 3. Root Cause 2: Browser-Only APIs
**The SDE 2 View:** Code that checks `window`, `localStorage`, or `screen.width` during the initial render will fail because the server has no concept of a "window."

```javascript
// ❌ Problem: window is undefined on server
function Sidebar() {
  const isMobile = window.innerWidth < 768; // Error on server, value mismatch on client
  return <div>{isMobile ? 'Mobile' : 'Desktop'}</div>;
}
```

---

### 4. Root Cause 3: Invalid HTML Nesting
**The SDE 2 View:** The browser "auto-corrects" invalid HTML before React even starts. For example, a `<div>` inside a `<p>` is illegal.
1. The server sends `<p><div>...</div></p>`.
2. The browser's parser sees this and automatically closes the `<p>` before the `<div>`, resulting in three nodes: `<p></p><div>...</div><p></p>`.
3. When React's hydration logic looks for the `<div>` inside the `<p>`, it's not there. **Hydration Mismatch.**

---

### 5. How to Fix (SDE 2 Strategies)

#### A. The `useEffect` Trick (Two-Pass Rendering)
Wait until the component has mounted on the client before rendering browser-specific or non-deterministic content.

```javascript
function Header() {
  const [isClient, setIsClient] = useState(false);

  useEffect(() => {
    setIsClient(true);
  }, []);

  // During SSR and the first Client render, this is null.
  // The 'Handshake' is successful because Server == Client.
  if (!isClient) return <div id="skeleton">Loading...</div>;

  return <div>Current Time: {new Date().toLocaleTimeString()}</div>;
}
```

#### B. Suppressing Warnings (The Escape Hatch)
If the mismatch is harmless (like a tiny text difference) and you don't want to fix it, use `suppressHydrationWarning`.

```javascript
<div suppressHydrationWarning>
  {new Date().toLocaleTimeString()}
</div>
```
*Note:* This only goes one level deep and should be used sparingly.

---

### 6. Architectural Impact: The Cost of Mismatch
Why is an SDE 2 so worried about a "warning" in the console?

1.  **Performance Death:** When hydration fails, React loses the "fast path." It has to perform a full re-render of the subtree. This blocks the main thread precisely when the user is trying to interact with the page.
2.  **UI Flickering:** The user might see the server-rendered value for 100ms, then a "flash" as the client-side value overwrites it.
3.  **Broken Events:** In some cases, if the mismatch is severe, event listeners might be attached to the wrong nodes, making buttons "dead" or non-responsive.

---

### 7. Modern React 18: Selective Hydration
With **Suspense**, React 18 introduced **Selective Hydration**. 
**Mechanics:** React can start hydrating parts of the page that have already arrived while other parts (wrapped in `<Suspense>`) are still streaming from the server. If a user clicks a button in a section that hasn't been hydrated yet, React will **prioritize** hydrating that specific section so the click can be handled.

### Summary
*   **Junior view:** It’s a warning in the console I should ignore.
*   **SDE 2 view:** Hydration is a **Node-to-VirtualNode mapping process**. Mismatches trigger a **Bailout** that forces React into an expensive **Full Re-render**, negating the performance benefits of SSR and potentially causing **Event Propagation** bugs.