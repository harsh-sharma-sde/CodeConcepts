---
title: CDN Strategies
description: Learn how to use Content Delivery Networks (CDNs) effectively for faster content delivery and better scalability
order: 52
---

To an SDE 2, a **CDN (Content Delivery Network)** is not just a place to host images; it is a **Distributed Reverse Proxy Cache** that sits at the "Edge" of the network.

Your goal with a CDN strategy is to minimize the **Physical Distance** between the data and the user, while maximizing the **Cache Hit Ratio (CHR)** to protect your origin server from traffic spikes.

---

### 1. The Strategy: Pull vs. Push
*   **Origin Pull (Most Common):** You host your files on a server (e.g., AWS S3 or an EC2). The first time a user requests a file, the CDN "pulls" it from your server and caches it.
*   **Push:** You manually upload files to the CDN's storage. Use this for extremely large files or assets that rarely change and need 100% availability.

---

### 2. Cache-Control: The "Rules of Engagement"
The SDE 2 manages the CDN behavior via HTTP Headers.

#### A. The Immutable Pattern (Hashed Assets)
For files generated by build tools (Vite/Webpack) that have a hash in the name (e.g., `main.a1b2c3.js`), use a long cache time. Since the filename changes if the content changes, we never need to "invalidate" this.

```http
Cache-Control: public, max-age=31536000, s-maxage=31536000, immutable
```
*   `max-age`: Tells the **browser** to cache for 1 year.
*   `s-maxage`: Tells the **CDN** to cache for 1 year.
*   `immutable`: Tells the browser not to even send a conditional request (`If-Modified-Since`) when the user refreshes.

#### B. The Stale-While-Revalidate Pattern
For files with the same name (e.g., `index.html`), you want them to be fast but updated.

```http
Cache-Control: public, s-maxage=60, stale-while-revalidate=86400
```
*   **Mechanics:** The CDN serves the cached version for 60 seconds. If a request comes in after 60 seconds but before 24 hours (86,400s), the CDN serves the **stale** version immediately and fetches the fresh version in the **background**.

---

### 3. SDE 2 Deep Dive: Origin Shielding (Tiered Caching)
In a high-traffic system, if a file expires, and 10,000 users request it at once, they all hit your origin server simultaneously (**Thundering Herd Problem**).

**The Solution:** Use an **Origin Shield**. 
This is an intermediate cache layer between the Edge nodes and your Server. Instead of 50 Edge nodes hitting your server, they all hit one "Shield" node, which then hits your server exactly once.

---

### 4. Edge Logic (Edge Functions)
Modern CDNs (Cloudflare Workers, Lambda@Edge) allow you to run code at the Edge. As an SDE 2, you use this for:
1.  **A/B Testing:** Routing 10% of users to a different version of `index.html`.
2.  **Authentication:** Checking a JWT at the edge before even hitting the origin.
3.  **Image Optimization:** Detecting the user's browser and converting a JPG to WebP on-the-fly.

```javascript
// Example: Cloudflare Worker for A/B Testing
addEventListener('fetch', event => {
  const url = new URL(event.request.url);
  if (url.pathname === '/') {
    const group = Math.random() < 0.5 ? 'version-a' : 'version-b';
    event.respondWith(fetch(`https://origin.com/${group}/index.html`));
  }
});
```

---

### 5. Invalidation Strategies (The "Hard" Part)
When you fix a bug in `styles.css`, how do you tell the CDN?

1.  **Purging by URL:** Telling the CDN to delete `cdn.com/styles.css`. This is slow for many files.
2.  **Purging by Tag (Cache Tags):** Grouping assets (e.g., all files related to the "Checkout" page). You send a header `X-Cache-Tag: checkout`. You can then purge the entire "checkout" tag in one API call.
3.  **Versioning (Best Practice):** Change the URL (`styles.v2.css` or `styles.css?v=2`). This avoids the "Cache Purge Propagation" delay entirely.

---

### 6. SDE 2 Checklist: Security & Performance
*   **WAF (Web Application Firewall):** Enable at the CDN level to block SQL injections and Bots before they reach your network.
*   **DDoS Protection:** CDNs have massive bandwidth (Terabits) compared to your server (Gigabits). They act as a "Sponge" for attacks.
*   **Brotli/Gzip:** Ensure the CDN is performing compression automatically.
*   **TLS Termination:** The CDN handles the SSL handshake near the user, reducing the Latency of the initial connection.

### Summary
*   **Junior view:** It's a faster way to serve my images.
*   **SDE 2 view:** It is a **Distributed Intelligence Layer** used for **Origin Offloading**, **Edge Computation**, and **Global Security**, where we control the **Request Lifecycle** using granular **Cache-Control headers** and **Automatic Invalidation** patterns.